<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LogicPals Admin ‚Äî Enterprise Console</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg: #0b1220;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --subtle: rgba(255,255,255,0.50);
      --brand: #22c55e;
      --brand-blue: #3b82f6;
      --warn: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,0.45);
      --radius: 16px;
      --radius2: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    
    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: radial-gradient(1200px 900px at 20% 0%, rgba(34,197,94,0.12), transparent 60%),
                  radial-gradient(1000px 800px at 80% 10%, rgba(59,130,246,0.10), transparent 55%),
                  var(--bg);
      min-height: 100vh;
    }
    
    a { color: inherit; text-decoration: none; }
    .wrap { max-width: 1400px; margin: 0 auto; padding: 22px; }
    
    /* Header */
    header {
      display: flex; gap: 16px; align-items: center; justify-content: space-between;
      padding: 14px 16px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: sticky; top: 14px; z-index: 20;
      backdrop-filter: blur(10px);
      flex-wrap: wrap;
    }
    
    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    
    .logo {
      width: 38px; height: 38px; border-radius: 12px;
      background: linear-gradient(135deg, rgba(34,197,94,0.95), rgba(59,130,246,0.85));
      box-shadow: 0 10px 30px rgba(34,197,94,0.20);
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 18px; color: white;
    }
    
    .title {
      display: flex; flex-direction: column; line-height: 1.1;
    }
    
    .title strong { font-size: 14px; letter-spacing: .2px; }
    .title span { font-size: 12px; color: var(--muted); }
    
    .right {
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
    }
    
    .pill {
      font-size: 12px; color: var(--muted);
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      border-radius: 999px;
      padding: 8px 10px;
      display: inline-flex; align-items: center; gap: 8px;
    }
    
    .pill code { font-family: var(--mono); font-size: 11px; color: rgba(255,255,255,0.85); }
    
    /* Buttons */
    .btn {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn:hover { background: rgba(255,255,255,0.10); border-color: rgba(255,255,255,0.22); }
    .btn:active { transform: translateY(1px); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .btn.primary {
      border-color: rgba(34,197,94,0.35);
      background: rgba(34,197,94,0.14);
    }
    .btn.primary:hover {
      background: rgba(34,197,94,0.20);
      border-color: rgba(34,197,94,0.55);
    }
    
    .btn.danger {
      border-color: rgba(239,68,68,0.35);
      background: rgba(239,68,68,0.12);
    }
    .btn.danger:hover {
      background: rgba(239,68,68,0.18);
      border-color: rgba(239,68,68,0.55);
    }
    
    /* Main Tabs */
    .main-tabs {
      display: flex;
      gap: 8px;
      padding: 14px 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      border-radius: var(--radius);
      margin-top: 16px;
      overflow-x: auto;
    }
    
    .main-tab {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 700;
      color: var(--muted);
      cursor: pointer;
      border: 1px solid transparent;
      background: transparent;
      transition: all .2s ease;
      white-space: nowrap;
    }
    
    .main-tab:hover {
      background: rgba(255,255,255,0.06);
    }
    
    .main-tab.active {
      color: rgba(255,255,255,0.95);
      background: rgba(255,255,255,0.10);
      border-color: var(--border);
    }
    
    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 16px;
      margin-top: 16px;
      align-items: start;
    }
    
    @media (max-width: 1080px) {
      .grid { grid-template-columns: 1fr; }
      header { position: relative; top: auto; }
    }
    
    /* Panel */
    .panel {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    
    .panel .hd {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      flex-wrap: wrap;
    }
    
    .panel .hd h2 {
      margin: 0;
      font-size: 13px;
      letter-spacing: .2px;
    }
    
    .panel .bd { padding: 14px 16px; }
    
    /* Tabs (sub-navigation) */
    .tabs {
      display: inline-flex;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      border-radius: 999px;
      padding: 4px;
      gap: 4px;
    }
    
    .tab {
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
      cursor: pointer;
      border: 0;
      background: transparent;
      transition: all .2s ease;
    }
    
    .tab.active {
      color: rgba(255,255,255,0.95);
      background: rgba(255,255,255,0.10);
    }
    
    /* Form Fields */
    .field {
      display: grid;
      gap: 6px;
      margin-bottom: 12px;
    }
    
    .field label {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.20);
      color: var(--text);
      outline: none;
      font-size: 13px;
      font-family: inherit;
      transition: border-color .2s ease;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: rgba(34,197,94,0.5);
    }
    
    textarea { min-height: 110px; resize: vertical; }
    input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.35); }
    
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .help {
      font-size: 12px; color: var(--subtle); line-height: 1.35;
    }
    
    /* KPI */
    .kpi {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .kpi .card {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      border-radius: 14px;
      padding: 12px;
    }
    
    .kpi .n {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: .2px;
    }
    
    .kpi .t {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    /* Table */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow: hidden;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(255,255,255,0.03);
    }
    
    thead th {
      text-align: left;
      font-size: 12px;
      color: var(--muted);
      padding: 12px 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      font-weight: 800;
    }
    
    tbody td {
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      vertical-align: top;
      font-size: 13px;
    }
    
    tbody tr:hover td {
      background: rgba(255,255,255,0.04);
    }
    
    tbody tr:last-child td { border-bottom: 0; }
    
    /* Badges */
    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      font-weight: 700;
      white-space: nowrap;
    }
    
    .badge.ok {
      border-color: rgba(34,197,94,0.35);
      background: rgba(34,197,94,0.10);
    }
    
    .badge.warn {
      border-color: rgba(245,158,11,0.38);
      background: rgba(245,158,11,0.10);
    }
    
    .badge.danger {
      border-color: rgba(239,68,68,0.38);
      background: rgba(239,68,68,0.10);
    }
    
    .muted { color: var(--muted); }
    .mono { font-family: var(--mono); font-size: 12px; color: rgba(255,255,255,0.80); }
    
    .actions {
      display: inline-flex; gap: 8px; align-items: center; flex-wrap: wrap;
    }
    
    .divider {
      height: 1px; background: rgba(255,255,255,0.10); margin: 14px 0;
    }
    
    /* Toast */
    .toast {
      position: fixed; right: 18px; bottom: 18px;
      max-width: 420px;
      display: grid;
      gap: 10px;
      z-index: 60;
    }
    
    .toast .item {
      border: 1px solid var(--border);
      background: rgba(12,18,32,0.95);
      backdrop-filter: blur(10px);
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 4px;
    }
    
    .toast .item .h { font-weight: 800; font-size: 12px; }
    .toast .item .b { font-size: 12px; color: var(--muted); line-height: 1.35; }
    
    /* Modal */
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 50;
    }
    
    .modal.show { display: flex; }
    
    .modal .card {
      width: min(1080px, 100%);
      max-height: 90vh;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(12,18,32,0.98);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .modal .card .top {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      flex-shrink: 0;
    }
    
    .modal .card .top .left {
      display: grid; gap: 4px;
    }
    
    .modal .card .top .left strong { font-size: 14px; }
    .modal .card .top .left span { font-size: 12px; color: var(--muted); }
    
    .modal .card .content {
      padding: 16px;
      overflow: auto;
      flex: 1;
    }
    
    .footer {
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap;
      background: rgba(255,255,255,0.03);
      flex-shrink: 0;
    }
    
    .hint {
      padding: 10px 12px;
      border: 1px solid rgba(245,158,11,0.35);
      border-radius: 14px;
      background: rgba(245,158,11,0.08);
      color: rgba(255,255,255,0.86);
      font-size: 12px;
      line-height: 1.35;
    }
    
    .small {
      font-size: 12px;
      color: var(--muted);
    }
    
    /* View Container */
    .view-container {
      display: none;
    }
    
    .view-container.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <header>
      <div class="brand">
        <div class="logo">LP</div>
        <div class="title">
          <strong>LogicPals Admin</strong>
          <span>Enterprise Console ‚Äî Complete Management System</span>
        </div>
      </div>
      <div class="right">
        <div class="pill">Project <code>LogicPals-App</code></div>
        <button class="btn" id="btnRefresh">üîÑ Refresh</button>
        <button class="btn primary" id="btnQuickAdd">+ Quick Add</button>
      </div>
    </header>

    <!-- Main Navigation Tabs -->
    <div class="main-tabs">
      <button class="main-tab active" data-view="dashboard">üìä Dashboard</button>
      <button class="main-tab" data-view="regular">üìù Regular Problems</button>
      <button class="main-tab" data-view="olympiad">üèÜ Olympiad Review</button>
      <button class="main-tab" data-view="payments">üí≥ Payments</button>
      <button class="main-tab" data-view="subscriptions">üìã Subscriptions</button>
      <button class="main-tab" data-view="users">üë• Users</button>
    </div>

    <!-- DASHBOARD VIEW -->
    <div id="view-dashboard" class="view-container active">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-top: 16px;">
        <div class="panel">
          <div class="bd" style="padding: 20px;">
            <div class="kpi">
              <div class="card">
                <div class="n" id="statRegular">‚Äî</div>
                <div class="t">Regular Problems</div>
              </div>
              <div class="card">
                <div class="n" id="statOlympiad">‚Äî</div>
                <div class="t">Olympiad Problems</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="panel">
          <div class="bd">
            <div class="hint" style="margin-bottom: 12px;">
              <strong>üéØ Quick Actions</strong>
            </div>
            <div style="display: grid; gap: 10px;">
              <button class="btn primary" style="width: 100%;" onclick="switchMainView('regular')">üìù Manage Regular</button>
              <button class="btn primary" style="width: 100%;" onclick="switchMainView('olympiad')">üèÜ Review Olympiad</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- REGULAR PROBLEMS VIEW -->
    <div id="view-regular" class="view-container">
      <div class="grid">
        <!-- Left: Filters -->
        <div class="panel">
          <div class="hd">
            <h2>Filters</h2>
            <button class="btn" id="btnResetRegular">Reset</button>
          </div>
          <div class="bd">
            <div class="hint">
              <strong>üìù Regular Problems</strong><br>
              Fast-track for general learning. Quick add, activate/deactivate, lightweight editing.
            </div>
            
            <div class="divider"></div>
            
            <div id="regularKpi" class="kpi">
              <div class="card">
                <div class="n" id="regularCount">‚Äî</div>
                <div class="t">Recent</div>
              </div>
              <div class="card">
                <div class="n" id="regularInactive">‚Äî</div>
                <div class="t">Inactive</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="field">
              <label>Search</label>
              <input id="regularSearch" placeholder="Title, text, category..." />
            </div>

            <div class="row">
              <div class="field">
                <label>Difficulty</label>
                <select id="regularDifficulty">
                  <option value="">Any</option>
                  <option value="easy">Easy</option>
                  <option value="medium">Medium</option>
                  <option value="hard">Hard</option>
                </select>
              </div>
              <div class="field">
                <label>Age</label>
                <select id="regularAge">
                  <option value="">Any</option>
                  <option value="8-9">8-9</option>
                  <option value="9-10">9-10</option>
                  <option value="10-11">10-11</option>
                  <option value="11-12">11-12</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label>Status</label>
              <select id="regularStatus">
                <option value="true">Active Only</option>
                <option value="">Any</option>
                <option value="false">Inactive Only</option>
              </select>
            </div>

            <button class="btn primary" id="btnApplyRegular" style="width: 100%;">Apply Filters</button>
          </div>
        </div>

        <!-- Right: Table -->
        <div class="panel">
          <div class="hd">
            <h2>Regular Problems</h2>
            <div class="actions">
              
        <a id="btnVisitSite" class="btn secondary" href="/" target="_blank" rel="noopener">Visit site</a>
        <button id="btnLogout" class="btn secondary" type="button">Logout</button>
<span class="pill"><span class="muted">Showing</span> <code id="regularRowCount">0</code></span>
              <button class="btn" id="btnLoadMoreRegular">Load More</button>
            </div>
          </div>
          <div class="bd" style="padding: 0;">
            <div id="regularTableWrap"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- OLYMPIAD REVIEW VIEW (PRESERVE ALL ORIGINAL LOGIC) -->
    <div id="view-olympiad" class="view-container">
      <div class="grid">
        <!-- Left: Controls -->
        <div class="panel">
          <div class="hd">
            <h2>Review Controls</h2>
          </div>
          <div class="bd">
            <div class="hint" style="background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.35);">
              <strong>üèÜ Olympiad Track is Strict</strong><br>
              You MUST set <span class="mono">skill_track</span> + <span class="mono">review_reason</span> before publishing.
            </div>

            <div class="divider"></div>

            <div id="olympiadKpi" class="kpi">
              <div class="card">
                <div class="n" id="olympiadQueue">‚Äî</div>
                <div class="t">In Queue</div>
              </div>
              <div class="card">
                <div class="n" id="olympiadAttention">‚Äî</div>
                <div class="t">Needs Attention</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="field">
              <label>Search</label>
              <input id="olympiadSearch" placeholder="Title, text, skill_track..." />
            </div>

            <div class="field">
              <label>Skill Track</label>
              <select id="olympiadSkillTrack">
                <option value="">Any</option>
              </select>
            </div>

            <div class="field">
              <label>Publish State</label>
              <select id="olympiadPublishState">
                <option value="">Any</option>
                <option value="draft">Draft</option>
                <option value="review">In Review</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
              </select>
            </div>

            <button class="btn primary" id="btnApplyOlympiad" style="width: 100%;">Apply Filters</button>

            <div class="divider"></div>

            <div class="help">
              <strong>Olympiad Review Process:</strong><br>
              1. Check skill_track (must match allowed list)<br>
              2. Add review_reason (explain decision)<br>
              3. Set publish_state = 'published'<br>
              4. Problems without these show as "Needs Attention"
            </div>
          </div>
        </div>

        <!-- Right: Table -->
        <div class="panel">
          <div class="hd">
            <h2>Olympiad Review Queue</h2>
            <div class="actions">
              <span class="pill"><span class="muted">Showing</span> <code id="olympiadRowCount">0</code></span>
              <button class="btn" id="btnLoadMoreOlympiad">Load More</button>
            </div>
          </div>
          <div class="bd" style="padding: 0;">
            <div id="olympiadTableWrap"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAYMENTS VIEW (Placeholder) -->
    <div id="view-payments" class="view-container">
      <div class="panel">
        <div class="hd">
          <h2>Payment Activation</h2>
          <button class="btn primary">+ Manual Payment</button>
        </div>
        <div class="bd">
          <div class="hint">
            <strong>üí≥ Payment Management</strong><br>
            Activate subscriptions manually, track bKash/Nagad payments, manage free trials.
          </div>
          
          <div style="margin-top: 16px; padding: 40px; text-align: center; border: 2px dashed var(--border); border-radius: 14px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üí≥</div>
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">Payment System</div>
            <div class="muted">Integration from admin-payments.html will go here</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SUBSCRIPTIONS VIEW (Placeholder) -->
    <div id="view-subscriptions" class="view-container">
      <div class="panel">
        <div class="hd">
          <h2>Subscription Management</h2>
          <button class="btn primary">+ New Subscription</button>
        </div>
        <div class="bd">
          <div class="hint">
            <strong>üìã Subscription Management</strong><br>
            View all subscriptions, track expirations, manage renewals and upgrades.
          </div>
          
          <div style="margin-top: 16px; padding: 40px; text-align: center; border: 2px dashed var(--border); border-radius: 14px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">Subscription System</div>
            <div class="muted">Integration from admin-subscriptions.html will go here</div>
          </div>
        </div>
      </div>
    </div>

    <!-- USERS VIEW (Placeholder) -->
    <div id="view-users" class="view-container">
      <div class="panel">
        <div class="hd">
          <h2>User Management</h2>
        </div>
        <div class="bd">
          <div style="padding: 40px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 16px;">üë•</div>
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">Users Coming Soon</div>
            <div class="muted">Student accounts, progress tracking, and analytics</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast" id="toast"></div>

  <!-- Edit Modal (ORIGINAL FROM admin_enterprise.html) -->
  <div class="modal" id="modal">
    <div class="card">
      <div class="top">
        <div class="left">
          <strong id="mTitle">Edit Problem</strong>
          <span id="mMeta" class="small">‚Äî</span>
        </div>
        <div class="actions">
          <button class="btn" id="btnCopyId">Copy ID</button>
          <button class="btn danger" id="btnArchive">Archive</button>
          <button class="btn" id="btnClose">Close</button>
        </div>
      </div>
      <div class="content">
        <div class="row">
          <div class="field">
            <label>Title</label>
            <input id="f_title" />
          </div>
          <div class="field">
            <label>Section</label>
            <input id="f_section" disabled />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Age Category</label>
            <input id="f_age_category" placeholder="e.g., 9-10" />
          </div>
          <div class="field">
            <label>Difficulty</label>
            <select id="f_difficulty">
              <option value="">(unchanged)</option>
              <option value="easy">easy</option>
              <option value="medium">medium</option>
              <option value="hard">hard</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Category</label>
            <input id="f_category" placeholder="e.g., logic" />
          </div>
          <div class="field">
            <label>Curriculum Tags (JSON array)</label>
            <input id="f_tags" placeholder='e.g., ["bdmo","geometry"]' />
          </div>
        </div>

        <!-- OLYMPIAD-SPECIFIC FIELDS (PRESERVED FROM ORIGINAL) -->
        <div id="olympiadFields" style="display:none;">
          <div class="divider"></div>
          <div class="hint" style="background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.35);">
            <strong>‚ö†Ô∏è Olympiad Required Fields</strong>
          </div>
          <div class="row">
            <div class="field">
              <label>Skill Track (must match allowed list)</label>
              <select id="f_skill_track"></select>
            </div>
            <div class="field">
              <label>Publish State</label>
              <select id="f_publish_state">
                <option value="">(unchanged)</option>
                <option value="draft">draft</option>
                <option value="review">review</option>
                <option value="published">published</option>
                <option value="archived">archived</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label>Review Reason (explainable + audit-friendly)</label>
            <textarea id="f_review_reason" placeholder="Explain why the chosen skill_track is correct. Mention title/tags, key concept, and any ambiguity."></textarea>
          </div>
        </div>

        <div class="divider"></div>

        <div class="field">
          <label>Problem Text</label>
          <textarea id="f_problem_text" placeholder="Problem text..."></textarea>
        </div>
        <div class="row">
          <div class="field">
            <label>Answer Key</label>
            <textarea id="f_answer_key" placeholder="answer|acceptable|variations"></textarea>
          </div>
          <div class="field">
            <label>Solution Explanation</label>
            <textarea id="f_solution_explanation" placeholder="Explain solution step-by-step."></textarea>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Is Active</label>
            <select id="f_is_active">
              <option value="">(unchanged)</option>
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </div>
          <div class="field">
            <label>Last Updated</label>
            <input id="f_updated_at" disabled />
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="small" id="mFooterLeft">‚Äî</div>
        <div class="actions">
          <button class="btn" id="btnReset">Reset</button>
          <button class="btn primary" id="btnSave">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Add Modal (ORIGINAL FROM admin_enterprise.html) -->
  <div class="modal" id="modalAdd">
    <div class="card">
      <div class="top">
        <div class="left">
          <strong>Quick Add ‚Äî Regular Problem</strong>
          <span class="small">Creates a new regular problem</span>
        </div>
        <div class="actions">
          <button class="btn" id="btnAddClose">Close</button>
        </div>
      </div>
      <div class="content">
        <div class="row">
          <div class="field">
            <label>Title</label>
            <input id="a_title" placeholder="e.g., Train Tickets Puzzle" />
          </div>
          <div class="field">
            <label>Age Category</label>
            <input id="a_age_category" placeholder="e.g., 9-10" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Difficulty</label>
            <select id="a_difficulty">
              <option value="easy">easy</option>
              <option value="medium" selected>medium</option>
              <option value="hard">hard</option>
            </select>
          </div>
          <div class="field">
            <label>Category</label>
            <input id="a_category" placeholder="e.g., logic" />
          </div>
        </div>
        <div class="field">
          <label>Problem Text</label>
          <textarea id="a_problem_text" placeholder="Write the full problem..."></textarea>
        </div>
        <div class="row">
          <div class="field">
            <label>Answer Key</label>
            <textarea id="a_answer_key" placeholder="answer"></textarea>
          </div>
          <div class="field">
            <label>Solution Explanation</label>
            <textarea id="a_solution_explanation" placeholder="Explain briefly."></textarea>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="small">Quick add for Regular section only</div>
        <div class="actions">
          <button class="btn primary" id="btnAddCreate">Create</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    // ====== CONFIGURATION ======
    const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    
    // Safety check: make sure Supabase credentials are configured
    if (!SUPABASE_URL || SUPABASE_URL.includes('YOUR_') || !SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.includes('YOUR_')) {
      toast('Config missing', 'Set SUPABASE_URL and SUPABASE_ANON_KEY at the top of this file. Buttons won\'t work without it.');
      console.warn('Supabase config placeholders detected.');
    }
// ====== ALLOWED SKILL TRACKS (FROM ORIGINAL) ======
    const ALLOWED_SKILL_TRACKS = [
      'constraints',
      'counting',
      'divisibility',
      'geometry',
      'geometry_no_formulas',
      'invariants',
      'mixed',
      'patterns',
      'worst_case',
    ];

    // ====== STATE ======
    let currentView = 'dashboard';
    let currentSection = 'regular'; // 'regular' or 'olympiad'
    let regularPage = 0;
    let olympiadPage = 0;
    const PAGE_SIZE = 30;
    let currentRows = [];
    let originalRow = null;

    // ====== HELPERS (FROM ORIGINAL) ======
    const $ = (id) => document.getElementById(id);

    function toast(title, body, type="info") {
      const t = $("toast");
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `<div class="h">${escapeHtml(title)}</div><div class="b">${escapeHtml(body)}</div>`;
      t.appendChild(el);
      setTimeout(() => {
        el.style.opacity = "0";
        el.style.transform = "translateY(6px)";
        el.style.transition = "opacity .3s ease, transform .3s ease";
        setTimeout(() => el.remove(), 320);
      }, 3600);
    }

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function parseJsonArray(str) {
      const s = (str ?? "").trim();
      if (!s) return null;
      try {
        const v = JSON.parse(s);
        if (Array.isArray(v)) return v;
        return null;
      } catch {
        return null;
      }
    }

    function badgeFor(row, section) {
      if (section === "olympiad") {
        const st = row.skill_track;
        const rr = row.review_reason;
        const ps = row.publish_state;
        if (!st) return `<span class="badge warn">Needs skill_track</span>`;
        if (!rr) return `<span class="badge warn">Needs review_reason</span>`;
        if (ps === "published") return `<span class="badge ok">Published</span>`;
        if (ps === "review") return `<span class="badge warn">In review</span>`;
        return `<span class="badge">Draft</span>`;
      } else {
        if (row.is_active === false) return `<span class="badge danger">Inactive</span>`;
        return `<span class="badge ok">Active</span>`;
      }
    }

    function fmtTime(ts) {
      if (!ts) return "‚Äî";
      try {
        const d = new Date(ts);
        return d.toLocaleString();
      } catch {
        return String(ts);
      }
    }

    function safePreview(text, n=110) {
      const s = String(text ?? "");
      return s.length > n ? s.slice(0, n) + "‚Ä¶" : s;
    }

    // ====== VIEW SWITCHING ======
    function switchMainView(view) {
      currentView = view;
      
      // Hide all views
      document.querySelectorAll('.view-container').forEach(v => {
        v.classList.remove('active');
      });
      
      // Show selected view
      const viewEl = $(`view-${view}`);
      if (viewEl) viewEl.classList.add('active');
      
      // Update active tab
      document.querySelectorAll('.main-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.view === view) {
          tab.classList.add('active');
        }
      });
      
      // Load data
      loadViewData(view);
    }

    // Make it global
    window.switchMainView = switchMainView;

    // ====== INITIALIZE ======
    document.querySelectorAll('.main-tab').forEach(tab => {
      tab.addEventListener('click', () => switchMainView(tab.dataset.view));
    });

    // Fill skill track dropdowns
    function fillSkillTrackDropdowns() {
      const olympiadSel = $("olympiadSkillTrack");
      const editSel = $("f_skill_track");
      const opts = ALLOWED_SKILL_TRACKS.map(v => `<option value="${v}">${v}</option>`).join("");
      olympiadSel.innerHTML = `<option value="">Any</option>` + opts;
      editSel.innerHTML = `<option value="">(unchanged)</option>` + opts;
    }

    // ====== DATA LOADING ======
    async function loadViewData(view) {
      if (view === 'dashboard') {
        await loadDashboardStats();
      } else if (view === 'regular') {
        await loadRegularProblems();
      } else if (view === 'olympiad') {
        await loadOlympiadProblems();
      }
    }

    async function loadDashboardStats() {
      try {
        const { count: regular } = await supabase
          .from('problems')
          .select('*', { count: 'exact', head: true })
          .eq('section', 'regular');
        
        const { count: olympiad } = await supabase
          .from('problems')
          .select('*', { count: 'exact', head: true })
          .eq('section', 'olympiad');
        
        $('statRegular').textContent = regular || 0;
        $('statOlympiad').textContent = olympiad || 0;
      } catch (error) {
        console.error('Error loading dashboard:', error);
      }
    }

    async function loadRegularProblems() {
      try {
        const search = $('regularSearch').value.trim();
        const difficulty = $('regularDifficulty').value;
        const age = $('regularAge').value;
        const status = $('regularStatus').value;

        let query = supabase
          .from('problems')
          .select('*', { count: 'exact' })
          .eq('section', 'regular')
          .order('created_at', { ascending: false })
          .range(regularPage * PAGE_SIZE, (regularPage + 1) * PAGE_SIZE - 1);

        if (search) {
          query = query.or(`title.ilike.%${search}%,problem_text.ilike.%${search}%,category.ilike.%${search}%`);
        }
        if (difficulty) query = query.eq('difficulty', difficulty);
        if (age) query = query.eq('age_category', age);
        if (status === 'true') query = query.eq('is_active', true);
        if (status === 'false') query = query.eq('is_active', false);

        const { data, error, count } = await query;

        if (error) throw error;

        currentRows = data || [];
        renderRegularTable(currentRows);
        $('regularRowCount').textContent = count || 0;

        // KPIs
        const { count: inactive } = await supabase
          .from('problems')
          .select('*', { count: 'exact', head: true })
          .eq('section', 'regular')
          .eq('is_active', false);
        
        $('regularCount').textContent = count || 0;
        $('regularInactive').textContent = inactive || 0;

      } catch (error) {
        console.error('Error loading regular problems:', error);
        toast('Error', 'Failed to load regular problems', 'danger');
      }
    }

    async function loadOlympiadProblems() {
      try {
        const search = $('olympiadSearch').value.trim();
        const skillTrack = $('olympiadSkillTrack').value;
        const publishState = $('olympiadPublishState').value;

        let query = supabase
          .from('problems')
          .select('*', { count: 'exact' })
          .eq('section', 'olympiad')
          .order('created_at', { ascending: false })
          .range(olympiadPage * PAGE_SIZE, (olympiadPage + 1) * PAGE_SIZE - 1);

        if (search) {
          query = query.or(`title.ilike.%${search}%,problem_text.ilike.%${search}%,skill_track.ilike.%${search}%`);
        }
        if (skillTrack) query = query.eq('skill_track', skillTrack);
        if (publishState) query = query.eq('publish_state', publishState);

        const { data, error, count } = await query;

        if (error) throw error;

        // Sort so incomplete problems appear first
        const sorted = (data || []).sort((a,b) => {
          const aBad = (!a.skill_track || !a.review_reason) ? 0 : 1;
          const bBad = (!b.skill_track || !b.review_reason) ? 0 : 1;
          if (aBad !== bBad) return aBad - bBad;
          return new Date(b.created_at) - new Date(a.created_at);
        });

        currentRows = sorted;
        renderOlympiadTable(sorted);
        $('olympiadRowCount').textContent = count || 0;

        // KPIs
        const { count: queue } = await supabase
          .from('problems')
          .select('*', { count: 'exact', head: true })
          .eq('section', 'olympiad')
          .in('publish_state', ['draft', 'review']);
        
        const { count: attention } = await supabase
          .from('problems')
          .select('*', { count: 'exact', head: true })
          .eq('section', 'olympiad')
          .or('skill_track.is.null,review_reason.is.null')
          .in('publish_state', ['draft', 'review']);
        
        $('olympiadQueue').textContent = queue || 0;
        $('olympiadAttention').textContent = attention || 0;

      } catch (error) {
        console.error('Error loading olympiad problems:', error);
        toast('Error', 'Failed to load olympiad problems', 'danger');
      }
    }

    // ====== RENDER TABLES ======
    function renderRegularTable(rows) {
      const wrap = $('regularTableWrap');
      
      if (!rows || rows.length === 0) {
        wrap.innerHTML = `<div style="padding: 40px; text-align: center;">
          <div class="muted">No regular problems found. Try adjusting filters or click Quick Add to create one.</div>
        </div>`;
        return;
      }

      const cols = ["Status", "Title", "Age", "Difficulty", "Category", "Created", "Actions"];
      const head = `<thead><tr>${cols.map(c => `<th>${c}</th>`).join("")}</tr></thead>`;

      const body = rows.map(r => {
        const status = badgeFor(r, 'regular');
        const title = `<div style="display:grid;gap:6px;">
          <div style="font-weight:800;">${escapeHtml(r.title || "Untitled")}</div>
          <div class="muted" style="line-height:1.3;">${escapeHtml(safePreview(r.problem_text, 120))}</div>
          <div class="mono">${escapeHtml(r.id)}</div>
        </div>`;
        const age = `<span class="muted">${escapeHtml(r.age_category || "‚Äî")}</span>`;
        const diff = `<span class="badge">${escapeHtml(r.difficulty || "‚Äî")}</span>`;
        const cat = `<span class="muted">${escapeHtml(r.category || "‚Äî")}</span>`;
        const created = `<span class="muted">${escapeHtml(fmtTime(r.created_at))}</span>`;
        const actions = `<div class="actions">
          <button class="btn" onclick="openEditModal('${r.id}', 'regular')">Edit</button>
          <button class="btn ${r.is_active ? 'danger' : 'primary'}" onclick="toggleActive('${r.id}', 'regular')">${r.is_active ? "Deactivate" : "Activate"}</button>
        </div>`;

        return `<tr>
          <td>${status}</td>
          <td>${title}</td>
          <td>${age}</td>
          <td>${diff}</td>
          <td>${cat}</td>
          <td>${created}</td>
          <td>${actions}</td>
        </tr>`;
      }).join("");

      wrap.innerHTML = `<table>${head}<tbody>${body}</tbody></table>`;
    }

    function renderOlympiadTable(rows) {
      const wrap = $('olympiadTableWrap');
      
      if (!rows || rows.length === 0) {
        wrap.innerHTML = `<div style="padding: 40px; text-align: center;">
          <div class="muted">No olympiad problems in queue. All problems are processed!</div>
        </div>`;
        return;
      }

      const cols = ["Status", "Title", "Skill Track", "Tags", "Created", "Actions"];
      const head = `<thead><tr>${cols.map(c => `<th>${c}</th>`).join("")}</tr></thead>`;

      const body = rows.map(r => {
        const status = badgeFor(r, 'olympiad');
        const title = `<div style="display:grid;gap:6px;">
          <div style="font-weight:800;">${escapeHtml(r.title || "Untitled")}</div>
          <div class="muted" style="line-height:1.3;">${escapeHtml(safePreview(r.problem_text, 120))}</div>
          <div class="mono">${escapeHtml(r.id)}</div>
        </div>`;
        
        const skill = r.skill_track 
          ? `<span class="badge">${escapeHtml(r.skill_track)}</span>` 
          : `<span class="badge warn">NULL</span>`;
        
        const skillDetail = r.review_reason 
          ? `<div class="muted" style="margin-top:6px;line-height:1.35;">${escapeHtml(safePreview(r.review_reason, 90))}</div>`
          : `<div class="badge warn" style="margin-top:6px;">No review_reason</div>`;
        
        const tags = Array.isArray(r.curriculum_tags) 
          ? `<span class="mono">${escapeHtml(JSON.stringify(r.curriculum_tags))}</span>` 
          : `<span class="muted">‚Äî</span>`;
        
        const created = `<span class="muted">${escapeHtml(fmtTime(r.created_at))}</span>`;
        
        const actions = `<div class="actions">
          <button class="btn" onclick="openEditModal('${r.id}', 'olympiad')">Edit</button>
          <button class="btn primary" onclick="quickAssign('${r.id}')">Quick Assign</button>
        </div>`;

        return `<tr>
          <td>${status}</td>
          <td>${title}</td>
          <td>${skill}${skillDetail}</td>
          <td>${tags}</td>
          <td>${created}</td>
          <td>${actions}</td>
        </tr>`;
      }).join("");

      wrap.innerHTML = `<table>${head}<tbody>${body}</tbody></table>`;
    }

    // ====== MODAL FUNCTIONS (FROM ORIGINAL) ======
    async function openEditModal(problemId, section) {
      try {
        const { data, error } = await supabase
          .from('problems')
          .select('*')
          .eq('id', problemId)
          .single();

        if (error) throw error;

        originalRow = structuredClone(data);
        
        $('mTitle').textContent = data.title || "Edit Problem";
        $('mMeta').textContent = `Section: ${data.section} ‚Ä¢ Created: ${fmtTime(data.created_at)}`;
        $('mFooterLeft').textContent = `ID: ${data.id}`;

        $('f_title').value = data.title ?? "";
        $('f_section').value = data.section ?? "";
        $('f_age_category').value = data.age_category ?? "";
        $('f_difficulty').value = "";
        $('f_category').value = data.category ?? "";
        $('f_tags').value = Array.isArray(data.curriculum_tags) ? JSON.stringify(data.curriculum_tags) : "";
        $('f_problem_text').value = data.problem_text ?? "";
        $('f_answer_key').value = data.answer_key ?? "";
        $('f_solution_explanation').value = data.solution_explanation ?? "";
        $('f_is_active').value = "";
        $('f_updated_at').value = fmtTime(data.updated_at ?? data.created_at);

        const isOlympiad = data.section === "olympiad";
        $('olympiadFields').style.display = isOlympiad ? "" : "none";

        if (isOlympiad) {
          $('f_skill_track').value = "";
          $('f_review_reason').value = data.review_reason ?? "";
          $('f_publish_state').value = "";
        }

        $('modal').classList.add('show');
      } catch (error) {
        console.error('Error loading problem:', error);
        toast('Error', 'Failed to load problem', 'danger');
      }
    }

    window.openEditModal = openEditModal;

    function closeModal() {
      $('modal').classList.remove('show');
      originalRow = null;
    }

    function getEditPayload() {
      if (!originalRow) return null;

      const payload = {};

      if ($('f_title').value.trim() !== originalRow.title) 
        payload.title = $('f_title').value.trim();

      if ($('f_difficulty').value) 
        payload.difficulty = $('f_difficulty').value;

      const age = $('f_age_category').value.trim();
      if (age !== (originalRow.age_category ?? "")) 
        payload.age_category = age;

      const cat = $('f_category').value.trim();
      if (cat !== (originalRow.category ?? "")) 
        payload.category = cat;

      const tags = parseJsonArray($('f_tags').value);
      if (tags !== null) payload.curriculum_tags = tags;

      const pt = $('f_problem_text').value;
      if (pt !== (originalRow.problem_text ?? "")) 
        payload.problem_text = pt;

      const ak = $('f_answer_key').value;
      if (ak !== (originalRow.answer_key ?? "")) 
        payload.answer_key = ak;

      const se = $('f_solution_explanation').value;
      if (se !== (originalRow.solution_explanation ?? "")) 
        payload.solution_explanation = se;

      if ($('f_is_active').value) 
        payload.is_active = ($('f_is_active').value === "true");

      // OLYMPIAD-SPECIFIC (FROM ORIGINAL)
      if (originalRow.section === "olympiad") {
        if ($('f_skill_track').value) 
          payload.skill_track = $('f_skill_track').value;
        
        const rr = $('f_review_reason').value.trim();
        if (rr !== (originalRow.review_reason ?? "")) 
          payload.review_reason = rr;
        
        if ($('f_publish_state').value) 
          payload.publish_state = $('f_publish_state').value;
      }

      return payload;
    }

    async function saveEdits() {
      const payload = getEditPayload();
      if (!payload) return;

      if (Object.keys(payload).length === 0) {
        toast("Nothing to save", "No changes detected.");
        return;
      }

            // OLYMPIAD SAFETY CHECK (enterprise): block unsafe publish transitions
            if (originalRow.section === "olympiad") {
              const nextPublish = payload.publish_state ?? originalRow.publish_state;
              const nextSkill = payload.skill_track ?? originalRow.skill_track;
              const nextReason = payload.review_reason ?? originalRow.review_reason;

              // 1) If skill_track provided, it must be one of the allowed values.
              if (nextSkill != null && String(nextSkill).trim() !== "" && !ALLOWED_SKILL_TRACKS.includes(String(nextSkill))) {
                toast(
                  "Invalid skill_track",
                  `skill_track must be one of: ${ALLOWED_SKILL_TRACKS.join(", ")}`,
                  "danger"
                );
                return;
              }

              // 2) If moving into review/published, require explainable assignment.
              if (
                (nextPublish === "review" || nextPublish === "published") &&
                (!nextSkill || String(nextSkill).trim() === "" || !nextReason || String(nextReason).trim() === "")
              ) {
                toast(
                  "Blocked: Olympiad requires explainable assignment",
                  "Before setting publish_state to review/published, you MUST set both skill_track and review_reason.",
                  "danger"
                );
                return;
              }
            }

            const { error } = await supabase
        .from("problems")
        .update(payload)
        .eq("id", originalRow.id);

      if (error) {
        toast("Save failed", error.message || String(error), "danger");
        return;
      }

      toast("Saved", "Problem updated successfully.");
      closeModal();
      loadViewData(currentView);
    }

    async function toggleActive(problemId, section) {
      const row = currentRows.find(r => r.id === problemId);
      if (!row) return;
      
      const next = !(row.is_active === true);
      const { error } = await supabase
        .from("problems")
        .update({ is_active: next })
        .eq("id", problemId);

      if (error) {
        toast("Update failed", error.message || String(error), "danger");
        return;
      }

      toast("Updated", next ? "Activated" : "Deactivated");
      loadViewData(currentView);
    }

    window.toggleActive = toggleActive;

    async function archiveProblem() {
      if (!originalRow) return;
      
      const payload = { is_active: false };
      if (originalRow.section === "olympiad") 
        payload.publish_state = "archived";

      const { error } = await supabase
        .from("problems")
        .update(payload)
        .eq("id", originalRow.id);

      if (error) {
        toast("Archive failed", error.message || String(error), "danger");
        return;
      }

      toast("Archived", "Problem archived successfully.");
      closeModal();
      loadViewData(currentView);
    }

    async function quickAssign(problemId) {
      // Open modal in olympiad mode
      await openEditModal(problemId, 'olympiad');
      
      toast("Quick Assign", "Set skill_track and review_reason, then save.");
    }

    window.quickAssign = quickAssign;

    // ====== QUICK ADD (FROM ORIGINAL) ======
    async function createQuickProblem() {
      const title = $('a_title').value.trim();
      const age = $('a_age_category').value.trim();
      const difficulty = $('a_difficulty').value;
      const category = $('a_category').value.trim();
      const problem_text = $('a_problem_text').value.trim();
      const answer_key = $('a_answer_key').value.trim();
      const solution = $('a_solution_explanation').value.trim();

      if (!title || !problem_text) {
        toast("Validation", "Title and problem text are required.");
        return;
      }

      const newProblem = {
        section: 'regular',
        title,
        age_category: age || null,
        difficulty: difficulty || 'medium',
        category: category || null,
        problem_text,
        answer_key: answer_key || null,
        solution_explanation: solution || null,
        is_active: true,
        created_at: new Date().toISOString()
      };

      const { error } = await supabase
        .from('problems')
        .insert([newProblem]);

      if (error) {
        toast("Create failed", error.message || String(error), "danger");
        return;
      }

      toast("Created", "Regular problem created successfully!");
      $('modalAdd').classList.remove('show');
      
      // Clear form
      $('a_title').value = '';
      $('a_age_category').value = '';
      $('a_category').value = '';
      $('a_problem_text').value = '';
      $('a_answer_key').value = '';
      $('a_solution_explanation').value = '';

      if (currentView === 'regular') {
        loadRegularProblems();
      }
    }

    // ====== EVENT LISTENERS ======
    $('btnRefresh')?.addEventListener('click', () => loadViewData(currentView));
    $('btnQuickAdd')?.addEventListener('click', () => $('modalAdd').classList.add('show'));
    
    $('btnClose')?.addEventListener('click', closeModal);
    $('btnSave')?.addEventListener('click', saveEdits);
    $('btnArchive')?.addEventListener('click', archiveProblem);
    $('btnReset')?.addEventListener('click', () => {
      if (originalRow) openEditModal(originalRow.id, originalRow.section);
    });
    $('btnCopyId')?.addEventListener('click', () => {
      if (originalRow) {
        navigator.clipboard.writeText(originalRow.id);
        toast("Copied", "Problem ID copied to clipboard");
      }
    });

    $('btnAddClose')?.addEventListener('click', () => $('modalAdd').classList.remove('show'));
    $('btnAddCreate')?.addEventListener('click', createQuickProblem);

    $('btnApplyRegular')?.addEventListener('click', () => {
      regularPage = 0;
      loadRegularProblems();
    });
    
    $('btnApplyOlympiad')?.addEventListener('click', () => {
      olympiadPage = 0;
      loadOlympiadProblems();
    });

    $('btnLoadMoreRegular')?.addEventListener('click', () => {
      regularPage++;
      loadRegularProblems();
    });

    $('btnLoadMoreOlympiad')?.addEventListener('click', () => {
      olympiadPage++;
      loadOlympiadProblems();
    });

    $('btnResetRegular')?.addEventListener('click', () => {
      $('regularSearch').value = '';
      $('regularDifficulty').value = '';
      $('regularAge').value = '';
      $('regularStatus').value = 'true';
      regularPage = 0;
      loadRegularProblems();
    });
    // Expose functions used by inline onclick handlers
    Object.assign(window, { switchMainView, openEditModal, toggleActive, quickAssign });

    // Header actions
    $('btnLogout')?.addEventListener('click', async () => {
      try {
        await supabase.auth.signOut();
      } catch (e) {
        console.warn('Logout failed', e);
      } finally {
        // If you have a dedicated login page, redirect there instead:
        // window.location.href = '/admin-login.html';
        window.location.reload();
      }
    });



    // ====== INITIALIZATION ======
    fillSkillTrackDropdowns();
    loadDashboardStats();
  </script>
</body>
</html>
